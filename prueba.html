<div id="api-login">
  <h4>Login API Pagos Web</h4>
  <label>Usuario:
    <input type="text" id="apex-username" value="aqpa">
  </label>
  <label>Clave:
    <input type="password" id="apex-password" value="123456">
  </label>
  <button id="apex-btn-login">Login</button>
  <p id="apex-login-error" style="color:red; display:none;">Usuario/clave inválidos</p>
</div>

<div id="api-consulta" style="display:none; margin-top:1em">
  <h4>Consulta Deuda</h4>
  <label>Documento:
    <input type="text" id="apex-nro" value="4510123">
  </label>
  <label>Moneda:
    <input type="number" id="apex-moneda" value="1">
  </label>
  <button id="apex-btn-consulta">Consultar</button>
</div>

<pre id="apex-output" style="background:#f0f0f0;padding:1em; display:none;"></pre>

<script>
  const loginUrl = "http://127.0.0.1:8000/token";  // Para el login Asegúrate que la URL sea correcta

document.getElementById("apex-btn-login").addEventListener("click", async () => {
  const user = document.getElementById("apex-username").value;
  const pass = document.getElementById("apex-password").value;

  // Solicitud de login
  try {
    const response = await fetch(loginUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
      },
      body: new URLSearchParams({
        username: user,
        password: pass
      }),
    });

    if (!response.ok) {
      throw new Error("Error en la solicitud de login");
    }

    const data = await response.json();
    console.log(data);  // Asegúrate de que contenga el token
    const jwtToken = data.access_token;  // Token JWT
    console.log("JWT Token:", jwtToken);

    // Si el login es exitoso, oculta el formulario de login y muestra la consulta
    document.getElementById("api-login").style.display = "none";
    document.getElementById("api-consulta").style.display = "block";

    // Aquí guardas el JWT token en una variable o localStorage para usarlo después
    localStorage.setItem('jwt_token', jwtToken);  // Usar localStorage para almacenar el token

  } catch (error) {
    console.error("Error de login:", error);
    document.getElementById("apex-login-error").style.display = "block";
  }
});

</script>
